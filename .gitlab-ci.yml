stages:
  - build
  # - release

variables:
  # Use the tag name as version, fallback to commit SHA for non-tag builds
  VERSION: $(bump --print)

# Build job for regular commits (testing)
build:
  except:
    - tags
  stage: build
  image: 
    name: registry.gitlab.com/ballast-dev/sinkd/amd64:0.1.0
    entrypoint: [""]
  script:
    - just ci
  artifacts:
    paths:
      - target/x86_64-unknown-linux-gnu/release/sinkd
      - target/aarch64-unknown-linux-gnu/release/sinkd
    expire_in: 7 days
